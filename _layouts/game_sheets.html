---
layout: default
---

<h1>Game Sheets</h1>

<div class="tab">
    <button class="tablinks active" onclick="openTab(event, 'CharacterSheet')">
        Character Sheet
    </button>
    <button class="tablinks" onclick="openTab(event, 'QuickReference')">
        Quick Reference
    </button>
    <button class="tablinks" onclick="openTab(event, 'DamageExamples')">
        Damage Examples
    </button>
    <!-- <button class="tablinks" onclick="openTab(event, 'Role')">Role</button> -->
</div>

<div id="CharacterSheet" class="tabcontent" style="display: block">
    <h3>Character Sheet</h3>
    <div class="character_sheet">
        <!-- Header Row -->
        <div class="class_header">
            <b>Class</b>
        </div>

        <div class="character_name">
            <input
                type="text"
                id="character_name"
                name="character_name"
                placeholder="Character Name"
            />
        </div>

        <div class="character_class">
            <select id="class_select" name="characterclass">
                <option value="Alchemist">Alchemist</option>
                <option value="Soldier">Soldier</option>
                <option value="Mage">Mage</option>
                <option value="Scoundrel">Scoundrel</option>
                <option value="Hybrid">Hybrid</option>
            </select>
        </div>

        <select
            class="hybrid_kit_type_01"
            id="hybrid_kit_type_01"
            name="1"
            style="visibility: hidden"
        >
            <!-- Options generated at runtime -->
        </select>

        <select
            class="hybrid_kit_type_02"
            id="hybrid_kit_type_02"
            name="2"
            style="visibility: hidden"
        >
            <!-- Options generated at runtime -->
        </select>

        <!-- Health and Fortune/Prep Points Section -->
        <div class="health_header">
            <b>Health</b>
        </div>

        <div class="physical_health_text">
            <label>Physical Health</label>
        </div>

        <div class="mental_health_text">
            <label>Mental Health</label>
        </div>

        <div class="physical_health_track" id="physical_health_track">
            <!-- Checkboxes are created at runtime. -->
            <!-- <input type="checkbox"> -->
        </div>

        <div class="mental_health_track" id="mental_health_track">
            <!-- Checkboxes are created at runtime. -->
            <!-- <input type="checkbox"> -->
        </div>

        <div class="fortune_point_text">
            <label>Fortune Points</label>
        </div>

        <div class="prep_point_text">
            <label>Prep Points</label>
        </div>

        <div class="fortune_point_track" id="fortune_point_track">
            <!-- Checkboxes are created at runtime. -->
            <!-- <input type="checkbox"> -->
        </div>

        <div class="prep_point_track" id="prep_point_track">
            <!-- Checkboxes are created at runtime. -->
            <!-- <input type="checkbox"> -->
        </div>

        <!-- Skills Section -->
        <div class="skills_header">
            <b>Skills</b>
        </div>

        <div class="perception_text" id="perception_text">
            <label>Perception</label>
        </div>

        <div class="perception_value">
            <input
                type="number"
                value="0"
                min="0"
                ,
                max="4"
                class="skill_holder"
                id="perception_value"
                name="perception"
            />
        </div>

        <div class="knowledge_text" id="knowledge_text">
            <label>Knowledge</label>
        </div>

        <div class="knowledge_value">
            <input
                type="number"
                value="0"
                min="0"
                ,
                max="4"
                class="skill_holder"
                id="knowledge_value"
                name="knowledge"
            />
        </div>

        <div class="physique_text" id="physique_text">
            <label>Physique</label>
        </div>

        <div class="physique_value">
            <input
                type="number"
                value="0"
                min="0"
                ,
                max="4"
                class="skill_holder"
                id="physique_value"
                name="physique"
            />
        </div>

        <div class="bravery_text" id="bravery_text">
            <label>Bravery</label>
        </div>

        <div class="bravery_value">
            <input
                type="number"
                value="0"
                min="0"
                ,
                max="4"
                class="skill_holder"
                id="bravery_value"
                name="bravery"
            />
        </div>

        <div class="aura_text" id="aura_text">
            <label>Aura</label>
        </div>

        <div class="aura_value">
            <input
                type="number"
                value="0"
                min="0"
                ,
                max="4"
                class="skill_holder"
                id="aura_value"
                name="aura"
            />
        </div>

        <div class="focus_text" id="focus_text">
            <label>Focus</label>
        </div>

        <div class="focus_value">
            <input
                type="number"
                value="0"
                min="0"
                ,
                max="4"
                class="skill_holder"
                id="focus_value"
                name="focus"
            />
        </div>

        <div class="cunning_text" id="cunning_text">
            <label>Cunning</label>
        </div>

        <div class="cunning_value">
            <input
                type="number"
                value="0"
                min="0"
                ,
                max="4"
                class="skill_holder"
                id="cunning_value"
                name="cunning"
            />
        </div>

        <div class="agility_text" id="agility_text">
            <label>Agility</label>
        </div>

        <div class="agility_value">
            <input
                type="number"
                value="0"
                min="0"
                ,
                max="4"
                class="skill_holder"
                id="agility_value"
                name="agility"
            />
        </div>

        <!-- Kits Section -->
        <div class="kit_header">
            <b>Kits</b>
        </div>

        <div class="kit_chooser_01" name="1">
            <select id="kit_type_01" name="1">
                <option value="placeholder">Placeholder</option>
            </select>
            <select id="kit_01" name="1">
                <option value="potion">Potion</option>
            </select>
            <div id="kit_uses_01" name="1">
                <!-- Checkboxes are created at runtime. -->
                <!-- <input type="checkbox"> -->
            </div>
        </div>

        <div class="kit_text_01">
            <p id="kit_description_01" class="kit_description" name="1">
                Description
            </p>
        </div>

        <div class="kit_chooser_02" name="2">
            <select id="kit_type_02" name="2">
                <option value="placeholder">Placeholder</option>
            </select>
            <select id="kit_02" name="2">
                <option value="potion">Potion</option>
            </select>
            <div id="kit_uses_02" name="2">
                <!-- Checkboxes are created at runtime. -->
                <!-- <input type="checkbox"> -->
            </div>
        </div>

        <div class="kit_text_02">
            <p id="kit_description_02" class="kit_description" name="2">
                Description
            </p>
        </div>

        <div class="kit_chooser_03" name="3">
            <select id="kit_type_03" name="3">
                <option value="placeholder">Placeholder</option>
            </select>
            <select id="kit_03" name="3">
                <option value="potion">Potion</option>
            </select>
            <div id="kit_uses_03" name="3">
                <!-- Checkboxes are created at runtime. -->
                <!-- <input type="checkbox"> -->
            </div>
        </div>

        <div class="kit_text_03">
            <p id="kit_description_03" class="kit_description" name="3">
                Description
            </p>
        </div>

        <div class="kit_chooser_04" name="4">
            <select id="kit_type_04" name="4">
                <option value="placeholder">Placeholder</option>
            </select>
            <select id="kit_04" name="4">
                <option value="potion">Potion</option>
            </select>
            <div id="kit_uses_04" name="4">
                <!-- Checkboxes are created at runtime. -->
                <!-- <input type="checkbox"> -->
            </div>
        </div>

        <div class="kit_text_04">
            <p id="kit_description_04" class="kit_description" name="4">
                Description
            </p>
        </div>
    </div>
</div>

<div id="QuickReference" class="tabcontent">
    <h3>Quick Reference</h3>
    <table>
        <thead>
            <tr>
                <th>Roll</th>
                <th>Result</th>
            </tr>
        </thead>
        <tbody>
            <tr>
                <td>1</td>
                <td>-2</td>
            </tr>
            <tr>
                <td>2, 3</td>
                <td>-1</td>
            </tr>
            <tr>
                <td>4, 5, 6, 7</td>
                <td>+0</td>
            </tr>
            <tr>
                <td>8, 9</td>
                <td>+1</td>
            </tr>
            <tr>
                <td>10</td>
                <td>+2</td>
            </tr>
        </tbody>
    </table>

    <table>
        <thead>
            <tr>
                <th>Skill</th>
                <th>Description</th>
            </tr>
        </thead>
        <tbody>
            <tr>
                <td>
                    <strong
                        ><span style="color: #268bd2">Perception</span></strong
                    >
                </td>
                <td>Awareness, investigation, precision shooting.</td>
            </tr>
            <tr>
                <td>
                    <strong
                        ><span style="color: #268bd2">Knowledge</span></strong
                    >
                </td>
                <td>General know-how, rhetoric, and proficiency in alchemy.</td>
            </tr>
            <tr>
                <td>
                    <strong><span style="color: #d28445">Bravery</span></strong>
                </td>
                <td>Willpower, intimidation, and courage.</td>
            </tr>
            <tr>
                <td>
                    <strong
                        ><span style="color: #d28445">Physique</span></strong
                    >
                </td>
                <td>Strength, martial arts, and physical health.</td>
            </tr>
            <tr>
                <td>
                    <strong><span style="color: #953553">Aura</span></strong>
                </td>
                <td>
                    Rapport with spirits, supernatural charisma, and talent in
                    magic.
                </td>
            </tr>
            <tr>
                <td>
                    <strong><span style="color: #953553">Focus</span></strong>
                </td>
                <td>Concentration, sixth sense, and mental fortitude.</td>
            </tr>
            <tr>
                <td>
                    <strong><span style="color: #90a959">Cunning</span></strong>
                </td>
                <td>Stealth, misdirection, and lie detection.</td>
            </tr>
            <tr>
                <td>
                    <strong><span style="color: #90a959">Agility</span></strong>
                </td>
                <td>Mobility, evasion, and reaction time.</td>
            </tr>
        </tbody>
    </table>
</div>

<div id="DamageExamples" class="tabcontent">
    <h3>Damage Examples</h3>
    <table>
        <thead>
          <tr>
            <td><b>Type</b></td>
            <td><b>Examples</b></td>
            <td><b>Description</b></td>
          </tr>
        </thead>
        <tbody>
          <tr>
            <td>Standard</td>
            <td>Sword, Arrow, Bullet, Spirit of Fire</td>
            <td>One Box of Physical Damage</td>
          </tr>
          <tr>
            <td>Area of Effect</td>
            <td>Grenade, Hordebreaker, Fireball Spell</td>
            <td>One Box of Physical Damage vs. Many Targets</td>
          </tr>
          <tr>
            <td>Mental</td>
            <td>Intimidate/Provoke, Arta Valar, Spirit of Sound</td>
            <td>One Box of Mental Damage</td>
          </tr>
          <tr>
            <td>High Damage</td>
            <td>Iron Strength, Attack+Poison, Assassinate</td>
            <td>Two Boxes of Physical Damage</td>
          </tr>
          <tr>
            <td>Attack w/ Effect</td>
            <td>Swordbreaker, Arta Tuco</td>
            <td>One Box of Physical Damage + Effect</td>
          </tr>
          <tr>
            <td>Attack w/ Hazard</td>
            <td>Thermal Charges, Trenchsteel Charges, Fireball Spell</td>
            <td>One Box of Physical Damage + Environmental Hazard</td>
          </tr>
        </tbody>
      </table>
</div>

<!-- Interactive Form Script ----------------------------------------->
<script>
    // Globals //////////////////////////////////////////////////////////
    const kt_vals = [1, 2, 3, 4]
    const class_skill_mapping = {
    "Alchemist": {
        "perception": 2,
        "knowledge": 2,
        "physique": 0,
        "bravery": 0,
        "aura": 0,
        "focus": 0,
        "cunning": 0,
        "agility": 0},
    "Soldier": {
        "perception": 0,
        "knowledge": 0,
        "physique": 2,
        "bravery": 2,
        "aura": 0,
        "focus": 0,
        "cunning": 0,
        "agility": 0},
    "Mage": {
        "perception": 0,
        "knowledge": 0,
        "physique": 0,
        "bravery": 0,
        "aura": 2,
        "focus": 2,
        "cunning": 0,
        "agility": 0},
    "Scoundrel": {
        "perception": 0,
        "knowledge": 0,
        "physique": 0,
        "bravery": 0,
        "aura": 0,
        "focus": 0,
        "cunning": 2,
        "agility": 2},
    "Hybrid": {
        "perception": 0,
        "knowledge": 0,
        "physique": 0,
        "bravery": 0,
        "aura": 0,
        "focus": 0,
        "cunning": 0,
        "agility": 0}
    }
    const skill_holder_ids = ["perception_value",
                "knowledge_value",
                "physique_value",
                "bravery_value",
                "aura_value",
                "focus_value",
                "cunning_value",
                "agility_value"]
    const skill_health_mappings = {
    "physical_health_track": "physique",
    "mental_health_track": "focus",
    "fortune_point_track": "bravery",
    "prep_point_track": "cunning",
    "kit_uses_01": "knowledge",
    "kit_uses_02": "knowledge",
    "kit_uses_03": "knowledge",
    "kit_uses_04": "knowledge",
    }

    const skill_color_mapping = {
        "perception": "#268bd2",
        "knowledge": "#268bd2",
        "physique": "#d28445",
        "bravery": "#d28445",
        "aura": "#953553",
        "focus": "#953553",
        "cunning": "#90a959",
        "agility": "#90a959"
    }

    let class_selector = document.getElementById('class_select')
    let hybrid_kit_type_selectors = [document.getElementById('hybrid_kit_type_01'),
                                     document.getElementById('hybrid_kit_type_02')]
    let kit_type_selectors = [document.getElementById('kit_type_01'),
                             document.getElementById('kit_type_02'),
                             document.getElementById('kit_type_03'),
                             document.getElementById('kit_type_04')]
    let kit_selectors = [document.getElementById('kit_01'),
                         document.getElementById('kit_02'),
                         document.getElementById('kit_03'),
                         document.getElementById('kit_04')]
    let kit_description_selectors = [document.getElementById('kit_description_01'),
                                     document.getElementById('kit_description_02'),
                                     document.getElementById('kit_description_03'),
                                     document.getElementById('kit_description_04')]
    let skill_selectors = [document.getElementById("knowledge_value"),
                           document.getElementById("perception_value"),
                           document.getElementById("physique_value"),
                           document.getElementById("bravery_value"),
                           document.getElementById("aura_value"),
                           document.getElementById("focus_value"),
                           document.getElementById("agility_value"),
                           document.getElementById("cunning_value")]

    // Load Data ////////////////////////////////////////////////////////
    var data = {{ site.data.miracuse_kits | jsonify }}

    // Track Page State /////////////////////////////////////////////////
    // Initialize defaults
    var page_state = {
    "class": "",
    "kit_types": [""],
    "selected_hybrid_kit_types": ["", "",],
    "selected_kit_types": ["", "", "", ""],
    "selected_kits": ["", "", "", ""],
    "selected_kit_descriptions": ["", "", "", ""],
    "skills": {
        "perception": 0,
        "knowledge": 0,
        "physique": 0,
        "bravery": 0,
        "aura": 0,
        "focus": 0,
        "cunning": 0,
        "agility": 0},
    }

    // Helper Functions (Update Data) /////////////////////////////////////////////////
    function set_kit(kt_index, selection_index){
        // Get available kits for this kit type
        var available_kits = Array.from(new Set(data.filter(x => x.Type === page_state["selected_kit_types"][kt_index]).map(x => x.Kit)))
        var available_kit_descriptions = Array.from(new Set(data.filter(x => x.Type === page_state["selected_kit_types"][kt_index]).map(x => x.Description)))

        // Set the kit
        page_state["selected_kits"][kt_index] = available_kits[selection_index]
        page_state["selected_kit_descriptions"][kt_index] = available_kit_descriptions[selection_index]
    }

    function set_kit_type(kt_index, selection_index){
        if (page_state["class"] === "Hybrid") {
            // Kit types are selected from user input
            page_state["kit_types"] = page_state.selected_hybrid_kit_types
        }
        else {
            // Set kit types for class
            page_state["kit_types"] = Array.from(new Set(data.filter(x => x.Class === page_state["class"]).map(x => x.Type)))
        }

        // Set selected kit types to first value as defaults
        page_state["selected_kit_types"][kt_index] = page_state["kit_types"][selection_index]

        // Set selected kits to first value as defaults
        for(var i = 0; i < page_state["selected_kits"].length; i++){
            set_kit(i, 0)
        }
    }

    function set_skill(skill_name, value){
        page_state["skills"][skill_name] = value
    }

    function set_class(class_name){
        // Set the class
        page_state["class"] = class_name

        // Set the default skills for that class
        page_state["skills"] = class_skill_mapping[page_state["class"]]

        // Set the kits for that class
        for(var i = 0; i < page_state["selected_kit_types"].length; i++){
            set_kit_type(i, 0)
        }
    }

    function set_hybrid_kit_types(kt_index, value){
        page_state["selected_hybrid_kit_types"][kt_index] = value
    }

    // Helper Functions (Update Display) /////////////////////////////////////////////////
    function update_track(track_element, amount) {
        var current_track_size = track_element.childElementCount
        var diff_amount = current_track_size - amount
        for (var i=0; i<Math.abs(diff_amount); i++) {
            if (diff_amount > 0){
                track_element.removeChild(track_element.children[track_element.childElementCount - 1])
            }
            else if (diff_amount < 0){
                var new_box_element = document.createElement("input")
                new_box_element.type = "checkbox"
                track_element.appendChild(new_box_element)
            }
        }
    }

    function render_health_and_points(){
        // For each health track...
        Object.keys(skill_health_mappings).forEach(element => {
            // Get the track being modified
            var track_element = document.getElementById(element)

            // Get the number of boxes this track should have
            var matching_skill = skill_health_mappings[element]
            var box_count = page_state["skills"][skill_health_mappings[element]]
            if (matching_skill === "physique" || matching_skill === "focus") {box_count = box_count + 3}
            else if (matching_skill === "bravery" || matching_skill === "cunning") {box_count = box_count * 2}
            else if (matching_skill === "knowledge" ) {box_count = box_count + 2}

            // Account for certain kits that increase box count
            for (kit_name of page_state["selected_kits"]){
                if ((kit_name === "Arta Forteiza" && matching_skill === "physique") ||
                    (kit_name === "Iron Will" && matching_skill === "focus")){
                        box_count = box_count +1
                }
                else if ((kit_name === "Lucky" && matching_skill === "bravery") ||
                    (kit_name === "Prepared" && matching_skill === "cunning")) {
                        box_count = box_count +2
                    }
            }

            // Zero the track count for kit uses if the kit type is not alchemist
            if (track_element.id.includes("kit_uses")) {
                var kt_index = track_element.attributes.name.value - 1
                if (! (data.filter(x => x.Kit === page_state["selected_kits"][kt_index]).map(x => x.Tags)[0].includes("Alchemy"))){
                    box_count = 0
                }

            }

            // Update accordingly
            update_track(track_element, box_count)
        });
    }

    function render_skills(){
        // For each skill in the page state, set the value
        Object.keys(page_state["skills"]).forEach(element => {
            skill_value_selector = document.getElementById(element+"_value")
            skill_value_selector.value = page_state["skills"][element]
            console.log(element)
            skill_text_element = document.getElementById(element+"_text")

            if (page_state["skills"][element] > 0) {
                skill_text_element.style.color = skill_color_mapping[element]
                skill_text_element.style.fontWeight = "bold"
            }
            else {
                skill_text_element.style.color = ""
                skill_text_element.style.fontWeight = ""
            }
        });
    }

    function render_kit_description(kt_index){
        // Kit Description
        var kit_description_selector = kit_description_selectors[kt_index]

        // Replace existing text
        kit_description_selector.innerText = page_state["selected_kit_descriptions"][kt_index]
    }

    function update_kit_type_options(){
        for(var i=0; i<kit_type_selectors.length; i++) {
            // Update Kit Type Options
            //// Kit Type Selector
            var kit_type_selector = kit_type_selectors[i]

            //// Remove existing options
            while (kit_type_selector.childElementCount > 0) {
                kit_type_selector[kit_type_selector.childElementCount - 1].remove()
            }

            //// Add new options
            for(var j=0; j<page_state["kit_types"].length; j++){
                // Create option
                var opt = document.createElement("option")
                opt.value = page_state["kit_types"][j]
                opt.innerHTML = page_state["kit_types"][j]

                // Append to list
                kit_type_selector.appendChild(opt)
            }

            // Update related kit options
            update_kit_options(i)
        }
    }

    function update_kit_options(kt_index){
        // Kit Selector
        var kit_selector = kit_selectors[kt_index]

        // Kit Type Selector
        var kit_type_selector = kit_type_selectors[kt_index]

        // Remove existing options
        while (kit_selector.childElementCount > 0) {
            kit_selector[kit_selector.childElementCount - 1].remove()
        }

        // Add new options
        var kit_options = data.filter(x => x.Type === page_state["selected_kit_types"][kt_index]).map(x => x.Kit)
        for(var j=0; j<kit_options.length; j++){
            // Create option
            var opt = document.createElement("option")
            opt.value = kit_options[j]
            opt.innerHTML = kit_options[j]

            // Append to list
            kit_selector.appendChild(opt)
        }

        render_kit_description(kt_index)
    }

    function update_skill(skill, value){
        // Update the skill value
        page_state["skills"][skill] = parseInt(value,10)
    }

    function update_hybrid_kit_type(kt_index, selected_index){
        page_state["selected_hybrid_kit_types"][kt_index] = hybrid_kit_type_selectors[kt_index].options[selected_index].value
    }

    function render_hybrid_kit_type_selectors_visibility(){
        // Make hybrid kit type selectors visible/invisible
        // based on whether or not hybrid class is selected
        if (page_state["class"] === "Hybrid"){
            state_text = "visible"
        }
        else {
            state_text = "hidden"
        }

        for (kit_type_selector of hybrid_kit_type_selectors) {
            kit_type_selector.style.visibility = state_text
        }
    }

    function onetime_setup_hybrid_kit_type_selectors(){
        // Populate options
        for (kit_type_selector of hybrid_kit_type_selectors){
            for (kit_type of new Set(data.map(x => x.Type))){
                // Create option
                var opt = document.createElement("option")
                opt.value = kit_type
                opt.innerHTML = kit_type

                // Append to list
                kit_type_selector.appendChild(opt)
                }
            }

        // Set defaults
        set_hybrid_kit_types(0, "Drugs")
        set_hybrid_kit_types(1, "Drugs")
    }

    function render_page(){
        // Render hybrid kit type selectors
        render_hybrid_kit_type_selectors_visibility()

        // Render skills
        render_skills()

        // Render kit types
        update_kit_type_options()

        // Render kits and kit descriptions
        for(var i=0; i<kit_selectors.length; i++) {
            render_kit_description(i)
        }

        // Render health
        render_health_and_points()
    }

    // Helper Functions (Configure Listeners) ////////////////////////////////
    // Configure listeners to act on user input ///////////////////////////////
    function configure_listeners(){
        // Change Class
        class_selector.addEventListener('change', event => {
            set_class(window.event.srcElement.value)
            update_kit_type_options()
            render_page()
        })

        // Change Hybrid Class Kits
        for (hybrid_kit_type_selector of hybrid_kit_type_selectors){
            hybrid_kit_type_selector.addEventListener('change', event =>{
                update_hybrid_kit_type(window.event.srcElement.name-1, window.event.srcElement.selectedIndex)
                set_class("Hybrid")
                update_kit_type_options()
                render_page()
            })
        }

        // Change Kit Type
        for (kit_type_selector of kit_type_selectors) {
            kit_type_selector.addEventListener('change', event => {
                set_kit_type(window.event.srcElement.name-1, window.event.srcElement.selectedIndex)
                update_kit_options(window.event.srcElement.name-1)
                render_health_and_points()
            })
        }

        // Change Kit
        for (kit_selector of kit_selectors) {
            kit_selector.addEventListener('change', event =>
            {
                set_kit(window.event.srcElement.name-1, window.event.srcElement.selectedIndex)
                render_kit_description(window.event.srcElement.name-1)
                render_health_and_points()
            })
        }

        // Change skills
        for (skill_selector of skill_selectors) {
            skill_selector.addEventListener('change', event => {
                update_skill(window.event.srcElement.name, window.event.srcElement.value)
                render_skills()
                render_health_and_points()
            })
        }
    }


    // // Initialize Page ///////////////////////////////////////////////////
    // hybrid_skill_selector_onetime_setup()
    configure_listeners()
    onetime_setup_hybrid_kit_type_selectors()


    window.addEventListener('load', (event) => {
        set_class("Alchemist")
        render_page()
    });
</script>
